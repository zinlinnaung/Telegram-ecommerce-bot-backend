generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TransactionType {
  DEPOSIT
  PURCHASE
  REFUND
  WITHDRAW
}

enum DepositStatus {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id                  Int           @id @default(autoincrement())
  telegramId          BigInt        @unique
  username            String?
  firstName           String?
  balance             Decimal       @default(0.0) @db.Decimal(10, 2)
  welcomeBonusClaimed Boolean       @default(false)
  createdAt           DateTime      @default(now())
  transactions        Transaction[]
  deposits            Deposit[]
  purchases           Purchase[]
  bets                Bet[]
  withdraws           Withdraw[]
  highLowBets         HighLowBet[]
}

// model Product {
//   id          Int          @id @default(autoincrement())
//   name        String
//   category    String // e.g., "VPN", "Netflix"
//   description String?
//   price       Decimal      @db.Decimal(10, 2)
//   keys        ProductKey[]
//   purchases   Purchase[]
// }

model ProductKey {
  id         Int       @id @default(autoincrement())
  key        String    @unique // The actual VPN key or login credential
  isUsed     Boolean   @default(false)
  productId  Int
  product    Product   @relation(fields: [productId], references: [id])
  purchaseId Int?      @unique
  purchase   Purchase? @relation(fields: [purchaseId], references: [id])
}

model Deposit {
  id          Int           @id @default(autoincrement())
  userId      Int
  amount      Decimal       @db.Decimal(10, 2)
  method      String        @default("Unknown")
  proofFileId String // Stores Telegram File ID (works for Bot & WebApp now)
  status      DepositStatus @default(PENDING)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  user        User          @relation(fields: [userId], references: [id])
}

model Transaction {
  id          Int             @id @default(autoincrement())
  userId      Int
  amount      Decimal         @db.Decimal(10, 2)
  type        TransactionType
  description String?
  createdAt   DateTime        @default(now())
  user        User            @relation(fields: [userId], references: [id])
}

enum ProductType {
  AUTO // For VPN Keys, Netflix (Instant)
  MANUAL // For MLBB, PUBG (Requires Admin Action)
}

enum PurchaseStatus {
  PENDING // Waiting for Admin
  COMPLETED // Done
  REJECTED // Refunded
}

// 2. Update Product Model
model Product {
  id          Int          @id @default(autoincrement())
  name        String
  category    String
  description String?
  price       Decimal      @db.Decimal(10, 2)
  type        ProductType  @default(AUTO) // <--- Add this
  keys        ProductKey[]
  purchases   Purchase[]
}

// 3. Update Purchase Model
model Purchase {
  id        Int     @id @default(autoincrement())
  userId    Int
  productId Int
  amount    Decimal @db.Decimal(10, 2)

  // New Fields for Games
  playerId String? // Game User ID
  serverId String? // Server ID (for MLBB)
  nickname String? // Game Nickname (for PUBG)
  status   PurchaseStatus @default(COMPLETED) // Default COMPLETED for backward compatibility with Auto products

  createdAt  DateTime    @default(now())
  user       User        @relation(fields: [userId], references: [id])
  product    Product     @relation(fields: [productId], references: [id])
  productKey ProductKey?
}

model Bet {
  id        Int      @id @default(autoincrement())
  userId    Int
  type      String // "2D" သို့မဟုတ် "3D"
  number    String
  amount    Decimal  @db.Decimal(10, 2)
  session   String // "MORNING" သို့မဟုတ် "EVENING"
  status    String   @default("PENDING") // "PENDING", "WIN", "LOSE"
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

enum WithdrawStatus {
  PENDING
  APPROVED
  REJECTED
}

model Withdraw {
  id             Int            @id @default(autoincrement())
  userId         Int
  amount         Decimal        @db.Decimal(10, 2)
  method         String
  phoneNumber    String
  accountName    String? // ဤလိုင်းကို ထည့်ပေးပါ
  adminMessageId String? // Admin မှာပြန်လည်ဆောင်ရွက်ရာတွင် အသုံးပြုမည့် Telegram Message ID
  status         WithdrawStatus @default(PENDING)
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  user           User           @relation(fields: [userId], references: [id])
}

enum HighLowChoice {
  HIGH
  LOW
}

enum HighLowStatus {
  PENDING
  WIN
  LOSE
}

model HighLowBet {
  id        Int           @id @default(autoincrement())
  userId    Int
  amount    Decimal       @db.Decimal(10, 2)
  choice    HighLowChoice // User ရွေးချယ်မှု (High သို့မဟုတ် Low)
  resultNum Int? // ထွက်လာသည့် random ဂဏန်း (0-99)
  payout    Decimal?      @db.Decimal(10, 2) // အနိုင်ရလျှင် ရမည့်ပမာဏ
  status    HighLowStatus @default(PENDING)
  createdAt DateTime      @default(now())
  user      User          @relation(fields: [userId], references: [id])
}

model SystemSetting {
  id    Int    @id @default(autoincrement()) // default(1) ကို autoincrement() သို့ ပြောင်းပါ
  key   String @unique
  value String
}
